{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///./src/helpers/isDevContext.js","webpack:///./src/helpers/jsonapiMedia.js","webpack:///external \"@alexeimyshkouski/json-api\"","webpack:///./src/helpers/createInitialError.js","webpack:///external \"http-errors\"","webpack:///external \"lodash.defaultsdeep\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///./src/middleware/bodyParser.js","webpack:///./src/middleware/validate.js","webpack:///./src/middleware/errors.js","webpack:///./src/middleware/ensureErrorHandling.js","webpack:///external \"babel-runtime/core-js/object/define-properties\"","webpack:///./src/middleware/exposeContextProps.js","webpack:///external \"koa-router\"","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","w","s","require","ctx","app","env","_isDevContext","JSON_API_MEDIA_TYPES","JSON_API_MEDIA_TYPES_DEV","types","_isDevContext2","default","concat","stringify","arrayOfTypes","filter","type","join","error","_assign2","message","stack","jsonapiMedia","options","_ref","parser","_koaBodyparser2","_asyncToGenerator3","_regenerator2","mark","_callee2","next","wrap","_context2","prev","_callee","rawBody","_context","request","state","hasBody","length","stop","undefined","t0","throw","statusCode","details","headers","accept","_x","_x2","apply","this","arguments","_lodash2","response","_jsonApi2","validate","body","detail","meta","reasons","t1","mapErrorsToJsonApiErrors","isDev","id","status","expose","jsonapiError","title","jsonapiMeta","errors","initialError","Array","isArray","_createInitialError2","map","set","_error","push","_httpErrors2","properties","mapKeys","keys","reduce","_value","key","mediaTypes","jsonapi","_defineProperties2","rel","descriptor","prop","_ref2","path","_args","item","add","abrupt","sent","Router","patch","_koaRouter2","use","_ensureErrorHandling2","_exposeContextProps2","validatePatch","_errors2","_bodyParser2","_validate2","getSchemas"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// object with all compiled WebAssembly.Modules\n \t__webpack_require__.w = {};\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"babel-runtime/regenerator\");","export default ctx => ctx.app.env == 'development'\n","import isDevContext from '~/helpers/isDevContext'\n\nexport const JSON_API_MEDIA_TYPES = ['application/vnd.api+json']\nexport const JSON_API_MEDIA_TYPES_DEV = ['application/json']\n\nexport const types = ctx => isDevContext(ctx) ? [...JSON_API_MEDIA_TYPES, ...JSON_API_MEDIA_TYPES_DEV] : [...JSON_API_MEDIA_TYPES]\nexport const stringify = arrayOfTypes => arrayOfTypes.filter(type => !!type).join(',')\n","module.exports = require(\"@alexeimyshkouski/json-api\");","export default error => Object.assign({}, error, {\n  message: error.message,\n  stack: error.stack\n})\n","module.exports = require(\"http-errors\");","module.exports = require(\"lodash.defaultsdeep\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");","import bodyParser from 'koa-bodyparser'\nimport isDevContext from '../helpers/isDevContext'\nimport * as jsonapiMedia from '../helpers/jsonapiMedia'\n\nconst options = {\n  strict: true,\n  enableTypes: ['json'],\n  detectJSON: ctx => {\n    const mediaTypes = jsonapiMedia.types(ctx)\n    const isJSON = !!ctx.request.is(...mediaTypes)\n    ctx.assert(isJSON, 415)\n    return isJSON\n  }\n}\n\nexport default options => {\n  const parser = bodyParser(options)\n\n  return async (ctx, next) => {\n    try {\n      await parser(ctx, async () => {\n        const rawBody = ctx.request.rawBody\n        ctx.state.hasBody = !!(rawBody && rawBody.length)\n      })\n    } catch (error) {\n      ctx.throw(error.statusCode || 415, {\n        details: error.message,\n        headers: {\n          accept: jsonapiMedia.stringify(jsonapiMedia.types(ctx))\n        }\n      })\n    }\n\n    await next()\n  }\n}\n","import JsonApi from '@alexeimyshkouski/json-api'\nimport defaults from 'lodash.defaultsdeep'\n\nexport default options => {\n  options = defaults({}, options, {\n    request: true,\n    response: false\n  })\n\n  return async (ctx, next) => {\n    if (options.request && ctx.state.hasBody) {\n      try {\n        await JsonApi.validate(ctx.request.body)\n      } catch (error) {\n        ctx.throw(422, {\n          detail: `ValidationError: request body is not valid`,\n          meta: error.reasons\n        })\n      }\n    }\n\n    await next()\n\n    if (options.response) {\n      try {\n        await JsonApi.validate(ctx.body)\n      } catch (error) {\n        Object.assign({\n          detail: `ValidationError: response body is not valid`,\n          meta: error.reasons\n        })\n\n        throw error\n      }\n    }\n  }\n}\n","import HttpError from 'http-errors'\nimport isDevContext from '../helpers/isDevContext'\nimport * as jsonapiMedia from '../helpers/jsonapiMedia'\nimport createInitialError from '../helpers/createInitialError'\n\nconst mapErrorsToJsonApiErrors = isDev => error => {\n  const {\n    id,\n    status,\n    expose,\n    message,\n    detail,\n    stack,\n    headers,\n    meta\n  } = error\n\n  const jsonapiError = {\n    id: error.id,\n    status: error.status\n  }\n\n  if(isDev || expose) {\n    Object.assign(jsonapiError, {\n      title: message,\n      detail\n    })\n  }\n\n  if(isDev || headers) {\n    const jsonapiMeta = Object.assign({}, meta, {\n      headers,\n      stack: isDev ? stack : undefined\n    })\n\n    Object.assign(jsonapiError, {\n      meta: jsonapiMeta\n    })\n  }\n\n  return jsonapiError\n}\n\nexport default () => async (ctx, next) => {\n  const isDev = isDevContext(ctx)\n  const contentTypes = jsonapiMedia.types(ctx)\n\n  try {\n    await next()\n  } catch (errorOrErrors) {\n    let errors = (Array.isArray(errorOrErrors) ? errorOrErrors : [errorOrErrors])\n\n    const initialError = errors[0]\n\n    if(!initialError.status) {\n      ctx.throw(500, {\n        detail: `Initial error has no status code. Assuming it is an implementation error.`,\n        meta: {\n          initialError: createInitialError(initialError)\n        }\n      })\n    }\n\n    errors = errors.map(mapErrorsToJsonApiErrors(isDev))\n\n    if (errors.length > 1) {\n      if (initialError.status >= 500) {\n        ctx.status = 500\n      } else if (initialError.status >= 400) {\n        ctx.status = 400\n      }\n    } else {\n      ctx.status = initialError.status\n      if ('meta' in initialError && 'headers' in initialError.meta) {\n        ctx.set(initialError.meta.headers)\n      }\n    }\n\n    ctx.body = {\n      errors\n    }\n  }\n}\n","import HttpError from 'http-errors'\nimport isDevContext from '../helpers/isDevContext'\nimport createInitialError from '../helpers/createInitialError'\n\nexport default () => async (ctx, next) => {\n  try {\n    await next()\n    // throw new Error('test')\n  } catch (error) {\n    const isDev = isDevContext(ctx)\n    const errors = []\n\n    if (error.status) {\n      errors.push(Object.assign({\n        status: error.status\n      }, error))\n    } else {\n      const _error = new HttpError(500, {\n        detail: `JSON API implementation error`,\n        meta: isDev ? {\n          initialError: createInitialError(error)\n        } : undefined\n      })\n\n      errors.push(Object.assign({\n        status: _error.status\n      }, _error))\n    }\n\n    ctx.status = errors[0].status\n    ctx.body = {\n      errors\n    }\n  }\n}\n","module.exports = require(\"babel-runtime/core-js/object/define-properties\");","import JsonApi from '@alexeimyshkouski/json-api'\nimport * as jsonapiMedia from '../helpers/jsonapiMedia'\n\nconst properties = ['data', 'meta', 'links']\nconst mapKeys = (value, keys) => {\n  if(!value) {\n    return value\n  }\n\n  return keys\n    .reduce((_value, key) => {\n      _value[key] = value[key]\n      return _value\n    }, {})\n}\n\nexport default options => async (ctx, next) => {\n  ctx.body = {}\n  const mediaTypes = jsonapiMedia.types(ctx)\n\n  ctx.jsonapi = new JsonApi(\n    Object.assign({}, options, {\n      body: ctx.body\n    })\n  )\n\n  Object.defineProperties(ctx, {\n    rel: {\n      value() {\n        \n      }\n    }\n  })\n\n  Object.defineProperties(ctx, properties.reduce((descriptor, prop) => {\n    descriptor[prop] = {\n      async value(...args) {\n        let path = '', value, options = {}\n\n        if(typeof args[0] == 'string') {\n          path = args[0]\n          value = args[1]\n\n          if(args.length > 2) {\n            options = args[2]\n          }\n        } else {\n          value = args[0]\n          if(args.length > 1) {\n            options = args[1]\n          }\n        }\n\n        let _value\n\n        if('keys' in options) {\n          if(Array.isArray(value)) {\n            _value = value.map(item => mapKeys(item, options.keys))\n          } else {\n            _value = mapKeys(value, options.keys)\n          }\n        } else {\n          _value = value\n        }\n\n        return await ctx.jsonapi.add(`/${ prop }${ path }`, _value)\n      }\n    }\n\n    return descriptor\n  }, {}))\n\n  await next()\n\n  ctx.set('content-type', `${ mediaTypes[0] };charset=utf-8`)\n}\n","module.exports = require(\"koa-router\");","import Router from 'koa-router'\nimport defaults from 'lodash.defaultsdeep'\n\nimport JsonApi from '@alexeimyshkouski/json-api'\n\nimport exposeContextProps from './middleware/exposeContextProps'\nimport ensureErrorHandling from './middleware/ensureErrorHandling'\nimport errors from './middleware/errors'\nimport validate from './middleware/validate'\nimport bodyParser from './middleware/bodyParser'\n\nfunction JsonApiRouter(options) {\n  options = defaults({}, options, {\n    validate: {\n      patch: false,\n      request: true,\n      response: false\n    }\n  })\n  const router = new Router(options)\n\n  return router\n    .use(ensureErrorHandling())\n      .use(exposeContextProps({ validatePatch: options.validate.patch }))\n        .use(errors())\n          .use(bodyParser())\n            .use(validate({\n              request: options.validate.request,\n              response: options.validate.response\n            }))\n}\n\nexport { JsonApiRouter as Router }\n\nexport const getSchemas = options => JsonApi.getSchemas(options)\n"],"sourceRoot":""}