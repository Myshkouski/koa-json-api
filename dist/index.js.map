{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./../json-api/src/index.js","webpack:///./../json-api/src/mapValidationErrors.js","webpack:///../json-api/src/schemas.yaml","webpack:///./../json-api/src/validate.js","webpack:///./src/helpers/createInitialError.js","webpack:///./src/helpers/isDevContext.js","webpack:///./src/helpers/jsonapiMedia.js","webpack:///./src/index.js","webpack:///./src/middleware/bodyParser.js","webpack:///./src/middleware/ensureErrorHandling.js","webpack:///./src/middleware/errors.js","webpack:///./src/middleware/exposeContextProps.js","webpack:///./src/middleware/validate.js","webpack:///external \"@alexeimyshkouski/json-api\"","webpack:///external \"ajv\"","webpack:///external \"ajv-errors\"","webpack:///external \"babel-runtime/core-js/get-iterator\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/core-js/object/define-properties\"","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///external \"babel-runtime/helpers/typeof\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"http-errors\"","webpack:///external \"json8-patch\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-router\"","webpack:///external \"lodash.defaultsdeep\"","webpack:///external \"lodash/defaultsDeep\"","webpack:///external \"lodash/pick\""],"names":["JsonApi","ref","body","length","message","reasons","errors","map","doc","path","get","has","ops","options","reversible","res","apply","detail","validatePatch","validate","reverted","revert","value","op","patch","type","id","schemas","reduce","array","key","index","schema","attributes","push","Error","add","error","dataPath","parentSchema","$id","ajv","verbose","allErrors","jsonPointers","data","addSchema","addShema","getSchemas","_schemas","stack","ctx","app","env","JSON_API_MEDIA_TYPES","JSON_API_MEDIA_TYPES_DEV","types","stringify","arrayOfTypes","filter","join","JsonApiRouter","request","response","router","use","Router","jsonapiMedia","strict","enableTypes","detectJSON","mediaTypes","isJSON","is","assert","parser","next","rawBody","state","hasBody","throw","statusCode","details","headers","accept","isDev","status","_error","meta","initialError","undefined","mapErrorsToJsonApiErrors","expose","jsonapiError","title","jsonapiMeta","contentTypes","jsonapi","Array","isArray","set","includedPath","errorsPath","properties","transformDict","dict","obj","TypeError","_value","item","defaults","keys","unshift","hasErrors","hasData","hasIncluded"],"mappings":"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;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,E;;;;;;;;;;;;;;;;;;;ACvMA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMC,MAAM,kBAAQ;AAClBd,4BADkB;AAElBe,WAAS,IAFS;AAGlBC,aAAW,IAHO;AAIlBC,gBAAc;AAJI,CAAR,CAAZ;AAMA,yBAAUH,GAAV,EAAe,EAAf;;AAEO,IAAMtB,8BAAW,SAAXA,QAAW,CAAClB,GAAD,EAAM4C,IAAN;AAAA,SAAeJ,IAAItB,QAAJ,CAAalB,GAAb,EAAkB4C,IAAlB,CAAf;AAAA,CAAjB;AACA,IAAMC,gCAAY,SAAZA,SAAY;AAAA,SAAWL,IAAIM,QAAJ,CAAaf,MAAb,CAAX;AAAA,CAAlB;AACA,IAAMgB,kCAAa,SAAbA,UAAa,OAAQ;AAChC,MAAMrB,UAAU,EAAhB;;AAEA,OAAI,IAAIG,GAAR,I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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// object with all compiled WebAssembly.Modules\n \t__webpack_require__.w = {};\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import jsonPatch from 'json8-patch'\r\nimport defaults from 'lodash/defaultsDeep'\r\nimport { validate, getSchemas as _getSchemas } from './validate'\r\nimport mapValidationErrors from './mapValidationErrors'\r\n\r\nclass JsonApi {\r\n  static async validate(...args) {\r\n    let ref = '/', body = args[0]\r\n    if(args.length > 1) {\r\n      ref = args[0]\r\n      body = args[1]\r\n    }\r\n\r\n    try {\r\n      return await validate(ref, body)\r\n    } catch(error) {\r\n      throw {\r\n        message: `Validation error`,\r\n        reasons: error.errors.map(mapValidationErrors)\r\n      }\r\n    }\r\n  }\r\n\r\n  static get(doc, path) {\r\n    return jsonPatch.get(doc, path)\r\n  }\r\n\r\n  static has(doc, path) {\r\n    return jsonPatch.has(doc, path)\r\n  }\r\n\r\n  static async patch(body, ops, options = {}) {\r\n    options = defaults({}, options, {\r\n      reversible: false\r\n    })\r\n\r\n    let res\r\n\r\n    try {\r\n      try {\r\n        res = jsonPatch.apply(body, ops, options)\r\n      } catch(error) {\r\n        error.detail = `Cannot apply JSON patch`\r\n\r\n        throw error\r\n      }\r\n\r\n      if(options.validatePatch) {\r\n        try {\r\n          await JsonApi.validate(res.doc)\r\n        } catch(error) {\r\n          error.detail = `Document validation failed after patch has been applied`\r\n\r\n          throw error\r\n        }\r\n      }\r\n    } catch(error) {\r\n      if(options.reversible) {\r\n        const reverted = jsonPatch.revert(body, res.revert).doc\r\n\r\n        error.doc = reverted\r\n      }\r\n\r\n      error.ops = ops\r\n\r\n      throw error\r\n    }\r\n\r\n    return res\r\n  }\r\n\r\n  static async add(body, path, value, options) {\r\n    const ops = [\r\n      { op: 'add', path, value }\r\n    ]\r\n\r\n    return await JsonApi.patch(body, ops, options)\r\n  }\r\n\r\n  static getSchemas(options) {\r\n    options = defaults({}, options, {\r\n      type: 'schema',\r\n      id: '$id'\r\n    })\r\n\r\n    const schemas = _getSchemas()\r\n    return Object.keys(schemas).reduce((array, key, index) => {\r\n      const schema = {}\r\n\r\n      if(options.id == 'index') {\r\n        schema.id = index\r\n      } else {\r\n        schema.id = schemas[key][options.id]\r\n      }\r\n\r\n      schema.type = options.type\r\n\r\n      schema.attributes = schemas[key]\r\n\r\n      array.push(schema)\r\n\r\n      return array\r\n    }, [])\r\n  }\r\n\r\n  constructor(options = {}) {\r\n    this.options = {}\r\n\r\n    if('body' in options) {\r\n      if(typeof options.body != 'object') {\r\n        throw new Error(`'options.body' should be a JSON object`)\r\n      }\r\n      this.body = options.body\r\n    } else {\r\n      this.body = {}\r\n    }\r\n\r\n    if('validatePatch' in options) {\r\n      if(typeof options.validatePatch != 'boolean') {\r\n        throw new Error(`'options.validatePatch' should be 'true' or 'false'`)\r\n      }\r\n      this.options.validatePatch = options.validatePatch\r\n    } else {\r\n      this.options.validatePatch = false\r\n    }\r\n  }\r\n\r\n  \"get\"(path) {\r\n    return JsonApi.get(this.body, path)\r\n  }\r\n\r\n  has(path) {\r\n    return JsonApi.has(this.body, path)\r\n  }\r\n\r\n  async validate() {\r\n    return await JsonApi.validate(this.body)\r\n  }\r\n\r\n  async patch(ops) {\r\n    return await JsonApi.patch(this.body, ops, this.options)\r\n  }\r\n\r\n  async add(path, value) {\r\n    return await JsonApi.add(this.body, path, value, this.options)\r\n  }\r\n}\r\n\r\nexport default JsonApi\r\n","export default error => ({\r\n  message: error.message,\r\n  path: error.dataPath,\r\n  schema: error.parentSchema.$id\r\n})\r\n","module.exports = [\n\t{\n\t\t\"$id\": \"/\",\n\t\t\"$async\": true,\n\t\t\"allOf\": [\n\t\t\t{\n\t\t\t\t\"anyOf\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"required\": [\n\t\t\t\t\t\t\t\"data\"\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"required\": [\n\t\t\t\t\t\t\t\"errors\"\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"required\": [\n\t\t\t\t\t\t\t\"meta\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"errorMessage\": \"A document MUST contain at least one of the following top-level members: 'data', 'errors', 'meta'\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"not\": {\n\t\t\t\t\t\"required\": [\n\t\t\t\t\t\t\"errors\",\n\t\t\t\t\t\t\"data\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t\"errorMessage\": \"The members data and errors MUST NOT coexist in the same document\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"not\": {\n\t\t\t\t\t\"allOf\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"not\": {\n\t\t\t\t\t\t\t\t\"required\": [\n\t\t\t\t\t\t\t\t\t\"data\"\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"required\": [\n\t\t\t\t\t\t\t\t\"included\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t\"errorMessage\": \"If a document does not contain a top-level 'data' key, the 'included' member MUST NOT be present either\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"data\": {\n\t\t\t\t\t\t\"$ref\": \"/data\"\n\t\t\t\t\t},\n\t\t\t\t\t\"errors\": {\n\t\t\t\t\t\t\"$ref\": \"/errors\"\n\t\t\t\t\t},\n\t\t\t\t\t\"meta\": {\n\t\t\t\t\t\t\"$ref\": \"/meta\"\n\t\t\t\t\t},\n\t\t\t\t\t\"links\": {\n\t\t\t\t\t\t\"$ref\": \"/links\"\n\t\t\t\t\t},\n\t\t\t\t\t\"included\": {\n\t\t\t\t\t\t\"$ref\": \"/included\"\n\t\t\t\t\t},\n\t\t\t\t\t\"jsonapi\": {\n\t\t\t\t\t\t\"type\": \"object\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"additionalProperties\": false,\n\t\t\t\t\"errorMessage\": {\n\t\t\t\t\t\"type\": \"A JSON object MUST be at the root of every JSON API request and response containing data\",\n\t\t\t\t\t\"additionalProperties\": \"Unless otherwise noted, objects defined by this specification MUST NOT contain any additional members\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\t\"$id\": \"/data\",\n\t\t\"oneOf\": [\n\t\t\t{\n\t\t\t\t\"$ref\": \"/resource\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"$ref\": \"/included\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"null\"\n\t\t\t}\n\t\t],\n\t\t\"errorMessage\": \"Primary data MUST be either a single resource object, or a single resource identifier object, or null, for requests that target single resources, or an array of resource objects, or an array of resource identifier objects, or an empty array for requests that target resource collections\"\n\t},\n\t{\n\t\t\"$id\": \"/errors\",\n\t\t\"type\": \"array\",\n\t\t\"items\": {\n\t\t\t\"$ref\": \"/error\"\n\t\t},\n\t\t\"errorMessage\": {\n\t\t\t\"type\": \"Error objects MUST be returned as an array keyed by errors in the top level of a JSON API document\"\n\t\t}\n\t},\n\t{\n\t\t\"$id\": \"/links\",\n\t\t\"type\": \"object\",\n\t\t\"patternProperties\": {\n\t\t\t\"^.*\": {\n\t\t\t\t\"$ref\": \"/link\"\n\t\t\t}\n\t\t},\n\t\t\"additionalProperties\": false,\n\t\t\"errorMessage\": {\n\t\t\t\"type\": \"The value of each 'links' member MUST be an object\"\n\t\t}\n\t},\n\t{\n\t\t\"$id\": \"/included\",\n\t\t\"type\": \"array\",\n\t\t\"items\": {\n\t\t\t\"$ref\": \"/resource\"\n\t\t}\n\t},\n\t{\n\t\t\"$id\": \"/resource\",\n\t\t\"type\": \"object\",\n\t\t\"properties\": {\n\t\t\t\"id\": {\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"errorMessage\": \"The values of the 'id' member MUST be strings\"\n\t\t\t},\n\t\t\t\"type\": {\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"errorMessage\": \"The values of the 'type' member MUST be strings\"\n\t\t\t},\n\t\t\t\"meta\": {\n\t\t\t\t\"$ref\": \"/meta\"\n\t\t\t},\n\t\t\t\"attributes\": {\n\t\t\t\t\"type\": \"object\"\n\t\t\t},\n\t\t\t\"relationships\": {\n\t\t\t\t\"type\": \"array\",\n\t\t\t\t\"items\": {\n\t\t\t\t\t\"$ref\": \"/resource\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"links\": {\n\t\t\t\t\"$ref\": \"/links\"\n\t\t\t}\n\t\t},\n\t\t\"required\": [\n\t\t\t\"id\",\n\t\t\t\"type\"\n\t\t],\n\t\t\"additionalProperties\": false,\n\t\t\"errorMessage\": {\n\t\t\t\"required\": \"Every resource object MUST contain an 'id' member and a 'type' member\"\n\t\t}\n\t},\n\t{\n\t\t\"$id\": \"/error\",\n\t\t\"type\": \"object\"\n\t},\n\t{\n\t\t\"$id\": \"/meta\",\n\t\t\"type\": \"object\"\n\t},\n\t{\n\t\t\"$id\": \"/link\",\n\t\t\"oneOf\": [\n\t\t\t{\n\t\t\t\t\"type\": [\n\t\t\t\t\t\"string\"\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": [\n\t\t\t\t\t\"object\"\n\t\t\t\t],\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"href\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"errorMessage\": \"Member 'href' should be a string containing the link’s URL.\"\n\t\t\t\t\t},\n\t\t\t\t\t\"meta\": {\n\t\t\t\t\t\t\"$ref\": \"/meta\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"additionalProperties\": false\n\t\t\t}\n\t\t],\n\t\t\"errorMessage\": \"A 'link' MUST be represented either a string containing the link’s URL, or an object which can contain the 'href' and 'meta' members\"\n\t}\n];","import Ajv from 'ajv'\r\nimport AjvErrors from 'ajv-errors'\r\nimport schemas from './schemas'\r\n\r\nconst ajv = new Ajv({\r\n  schemas,\r\n  verbose: true,\r\n  allErrors: true,\r\n  jsonPointers: true\r\n})\r\nAjvErrors(ajv, {})\r\n\r\nexport const validate = (ref, data) => ajv.validate(ref, data)\r\nexport const addSchema = schemas => ajv.addShema(schema)\r\nexport const getSchemas = refs => {\r\n  const schemas = {}\r\n\r\n  for(let key in ajv._schemas) {\r\n    schemas[key] = ajv._schemas[key].schema\r\n  }\r\n\r\n  return schemas\r\n}\r\n","export default error => Object.assign({}, error, {\r\n  message: error.message,\r\n  stack: error.stack\r\n})\r\n","export default ctx => ctx.app.env == 'development'\r\n","import isDevContext from '~/helpers/isDevContext'\r\n\r\nexport const JSON_API_MEDIA_TYPES = ['application/vnd.api+json']\r\nexport const JSON_API_MEDIA_TYPES_DEV = ['application/json']\r\n\r\nexport const types = ctx => isDevContext(ctx) ? [...JSON_API_MEDIA_TYPES, ...JSON_API_MEDIA_TYPES_DEV] : [...JSON_API_MEDIA_TYPES]\r\nexport const stringify = arrayOfTypes => arrayOfTypes.filter(type => !!type).join(',')\r\n","import Router from 'koa-router'\r\nimport defaults from 'lodash.defaultsdeep'\r\n\r\nimport JsonApi from '@alexeimyshkouski/json-api'\r\n\r\nimport exposeContextProps from './middleware/exposeContextProps'\r\nimport ensureErrorHandling from './middleware/ensureErrorHandling'\r\nimport errors from './middleware/errors'\r\nimport validate from './middleware/validate'\r\nimport bodyParser from './middleware/bodyParser'\r\n\r\nfunction JsonApiRouter(options) {\r\n  options = defaults({}, options, {\r\n    validate: {\r\n      patch: false,\r\n      request: true,\r\n      response: false\r\n    }\r\n  })\r\n  \r\n  const router = new Router(options)\r\n\r\n  return router\r\n    .use(ensureErrorHandling())\r\n      .use(exposeContextProps({ validatePatch: options.validate.patch }))\r\n      .use(errors())\r\n        .use(bodyParser())\r\n        .use(validate({\r\n          request: options.validate.request,\r\n          response: options.validate.response\r\n        }))\r\n}\r\n\r\nexport { JsonApiRouter as Router }\r\n\r\nexport const getSchemas = options => JsonApi.getSchemas(options)\r\n","import bodyParser from 'koa-bodyparser'\r\nimport isDevContext from '../helpers/isDevContext'\r\nimport * as jsonapiMedia from '../helpers/jsonapiMedia'\r\n\r\nconst options = {\r\n  strict: true,\r\n  enableTypes: ['json'],\r\n  detectJSON: ctx => {\r\n    const mediaTypes = jsonapiMedia.types(ctx)\r\n    const isJSON = !!ctx.request.is(...mediaTypes)\r\n    ctx.assert(isJSON, 415)\r\n    return isJSON\r\n  }\r\n}\r\n\r\nexport default options => {\r\n  const parser = bodyParser(options)\r\n\r\n  return async (ctx, next) => {\r\n    try {\r\n      await parser(ctx, async () => {\r\n        const rawBody = ctx.request.rawBody\r\n        ctx.state.hasBody = !!(rawBody && rawBody.length)\r\n      })\r\n    } catch (error) {\r\n      ctx.throw(error.statusCode || 415, {\r\n        details: error.message,\r\n        headers: {\r\n          accept: jsonapiMedia.stringify(jsonapiMedia.types(ctx))\r\n        }\r\n      })\r\n    }\r\n\r\n    await next()\r\n  }\r\n}\r\n","import HttpError from 'http-errors'\r\nimport isDevContext from '../helpers/isDevContext'\r\nimport createInitialError from '../helpers/createInitialError'\r\n\r\nexport default () => async (ctx, next) => {\r\n  try {\r\n    await next()\r\n    // throw new Error('test')\r\n  } catch (error) {\r\n    const isDev = isDevContext(ctx)\r\n    const errors = []\r\n\r\n    if (error.status) {\r\n      errors.push(Object.assign({\r\n        status: error.status\r\n      }, error))\r\n    } else {\r\n      const _error = new HttpError(500, {\r\n        detail: `JSON API implementation error`,\r\n        meta: isDev ? {\r\n          initialError: createInitialError(error)\r\n        } : undefined\r\n      })\r\n\r\n      errors.push(Object.assign({\r\n        status: _error.status\r\n      }, _error))\r\n    }\r\n\r\n    ctx.status = errors[0].status\r\n    ctx.body = {\r\n      errors\r\n    }\r\n  }\r\n}\r\n","import HttpError from 'http-errors'\r\nimport isDevContext from '../helpers/isDevContext'\r\nimport * as jsonapiMedia from '../helpers/jsonapiMedia'\r\nimport createInitialError from '../helpers/createInitialError'\r\n\r\nconst mapErrorsToJsonApiErrors = isDev => error => {\r\n  const {\r\n    id,\r\n    status,\r\n    expose,\r\n    message,\r\n    detail,\r\n    stack,\r\n    headers,\r\n    meta\r\n  } = error\r\n\r\n  const jsonapiError = {\r\n    id: error.id,\r\n    status: error.status\r\n  }\r\n\r\n  if(isDev || expose) {\r\n    Object.assign(jsonapiError, {\r\n      title: message,\r\n      detail\r\n    })\r\n  }\r\n\r\n  if(isDev || headers) {\r\n    const jsonapiMeta = Object.assign({}, meta, {\r\n      headers,\r\n      stack: isDev ? stack : undefined\r\n    })\r\n\r\n    Object.assign(jsonapiError, {\r\n      meta: jsonapiMeta\r\n    })\r\n  }\r\n\r\n  return jsonapiError\r\n}\r\n\r\nexport default () => async (ctx, next) => {\r\n  const isDev = isDevContext(ctx)\r\n  const contentTypes = jsonapiMedia.types(ctx)\r\n\r\n  try {\r\n    await next()\r\n\r\n    if(ctx.jsonapi.has('/errors')) {\r\n      throw ctx.jsonapi.get('/errors')\r\n    }\r\n  } catch (errorOrErrors) {\r\n    let errors = (Array.isArray(errorOrErrors) ? errorOrErrors : [errorOrErrors])\r\n\r\n    const initialError = errors[0]\r\n\r\n    if(!initialError.status) {\r\n      ctx.throw(501, {\r\n        detail: `Initial error has no status code. Assuming it is an implementation error.`,\r\n        meta: {\r\n          initialError: createInitialError(initialError)\r\n        }\r\n      })\r\n    }\r\n\r\n    errors = errors.map(mapErrorsToJsonApiErrors(isDev))\r\n\r\n    if (errors.length > 1) {\r\n      if (initialError.status >= 500) {\r\n        ctx.status = 500\r\n      } else if (initialError.status >= 400) {\r\n        ctx.status = 400\r\n      }\r\n    } else {\r\n      ctx.status = initialError.status\r\n      if ('meta' in initialError && 'headers' in initialError.meta) {\r\n        ctx.set(initialError.meta.headers)\r\n      }\r\n    }\r\n\r\n    ctx.body = {\r\n      errors\r\n    }\r\n  }\r\n}\r\n","import JsonApi from 'test@alexeimyshkouski/json-api'\r\nimport defaults from 'lodash/defaultsDeep'\r\nimport pick from 'lodash/pick'\r\nimport * as jsonapiMedia from '../helpers/jsonapiMedia'\r\n\r\nconst dataPath = '/data'\r\nconst includedPath = '/included'\r\nconst errorsPath = '/errors'\r\n\r\nconst properties = ['data', 'meta', 'links']\r\n// const pick = (value, keys) => {\r\n//   if (!value) {\r\n//     return value\r\n//   }\r\n//\r\n//   return keys\r\n//     .reduce((_value, key) => {\r\n//       _value[key] = value[key]\r\n//       return _value\r\n//     }, {})\r\n// }\r\n\r\nconst transformDict = async (value, dict) => {\r\n  // console.log(value, dict)\r\n  if(typeof dict == 'string') {\r\n    return JsonApi.get(value, dict)\r\n  } else if(Array.isArray(dict)) {\r\n    const array = []\r\n\r\n    for(let index in dict) {\r\n      array[key] = await transformDict(value[key], dict[index])\r\n    }\r\n\r\n    return array\r\n  } else if(typeof dict == 'object') {\r\n    const obj = Object.assign({}, value)\r\n\r\n    for(let key in dict) {\r\n      obj[key] = await transformDict(value[key], dict[key])\r\n    }\r\n\r\n    return obj\r\n  } else {\r\n    const error = new TypeError('Canot apply dictionary to document')\r\n    error.doc = value\r\n    error.dict = dict\r\n    throw error\r\n  }\r\n}\r\n\r\nexport default options => async (ctx, next) => {\r\n  ctx.body = {}\r\n  const mediaTypes = jsonapiMedia.types(ctx)\r\n\r\n  ctx.jsonapi = new JsonApi(\r\n    Object.assign({}, options, {\r\n      body: ctx.body\r\n    })\r\n  )\r\n\r\n  Object.defineProperties(ctx, {\r\n    data: {\r\n      async value(...args) {\r\n        let path = dataPath,\r\n          value, options = {}\r\n        if (typeof args[0] == 'string') {\r\n          path += args[0]\r\n          value = args[1]\r\n\r\n          if (args.length > 2) {\r\n            options = args[2]\r\n          }\r\n        } else {\r\n          value = args[0]\r\n          if (args.length > 1) {\r\n            options = args[1]\r\n          }\r\n        }\r\n\r\n        options = defaults({}, options, {\r\n\r\n        })\r\n\r\n        const ops = []\r\n\r\n        if('dict' in options) {\r\n          if (Array.isArray(value)) {\r\n            const _value = []\r\n            for(let item of value) {\r\n              _value.push(await transformDict(item, options.dict))\r\n            }\r\n            value = _value\r\n          } else {\r\n            value = await transformDict(value, options.dict)\r\n          }\r\n        }\r\n\r\n        if ('defaults' in options) {\r\n          if (Array.isArray(value)) {\r\n            value = value.map(item => defaults(undefined, item, options.defaults))\r\n          } else {\r\n            value = defaults(undefined, value, options.defaults)\r\n          }\r\n        }\r\n\r\n        if ('keys' in options) {\r\n          if (Array.isArray(value)) {\r\n            value = value.map(item => pick(item, options.keys))\r\n          } else {\r\n            value = pick(value, options.keys)\r\n          }\r\n        }\r\n\r\n        if(this.jsonapi.has(path)) {\r\n          ops.unshift({ op: 'replace', path, value })\r\n        } else {\r\n          ops.unshift({ op: 'add', path, value })\r\n        }\r\n\r\n        return await this.jsonapi.patch(ops)\r\n      }\r\n    },\r\n    error: {\r\n      async value(value) {\r\n        const ops = [];\r\n        const hasErrors = this.jsonapi.has(errorsPath)\r\n        const hasData = this.jsonapi.has(dataPath)\r\n        let errors\r\n\r\n        if (hasErrors) {\r\n          errors = this.jsonapi.get(errorsPath)\r\n        } else {\r\n          errors = []\r\n        }\r\n\r\n        if (Array.isArray(value)) {\r\n          errors = [...errors, ...value]\r\n        } else {\r\n          errors = [...errors, value]\r\n        }\r\n\r\n        if (hasErrors) {\r\n          ops.unshift({\r\n            op: 'replace',\r\n            path: errorsPath,\r\n            value: errors\r\n          })\r\n        } else {\r\n          ops.unshift({\r\n            op: 'add',\r\n            path: errorsPath,\r\n            value: errors\r\n          })\r\n        }\r\n\r\n        if (hasData) {\r\n          ops.unshift({\r\n            op: 'remove',\r\n            path: dataPath\r\n          })\r\n          const hasIncluded = this.jsonapi.has(includedPath)\r\n          if (hasIncluded) {\r\n            ops.unshift({\r\n              op: 'remove',\r\n              path: includedPath\r\n            })\r\n          }\r\n        }\r\n\r\n        return await this.jsonapi.patch(ops)\r\n      }\r\n    }\r\n  })\r\n\r\n  // Object.defineProperties(ctx, properties.reduce((descriptor, prop) => {\r\n  //   descriptor[prop] = {\r\n  //     async value(...args) {\r\n  //       let path = '', value, options = {}\r\n  //\r\n  //       if(typeof args[0] == 'string') {\r\n  //         path = args[0]\r\n  //         value = args[1]\r\n  //\r\n  //         if(args.length > 2) {\r\n  //           options = args[2]\r\n  //         }\r\n  //       } else {\r\n  //         value = args[0]\r\n  //         if(args.length > 1) {\r\n  //           options = args[1]\r\n  //         }\r\n  //       }\r\n  //\r\n  //       let _value\r\n  //\r\n  //       if('keys' in options) {\r\n  //         if(Array.isArray(value)) {\r\n  //           _value = value.map(item => pick(item, options.keys))\r\n  //         } else {\r\n  //           _value = pick(value, options.keys)\r\n  //         }\r\n  //       } else {\r\n  //         _value = value\r\n  //       }\r\n  //\r\n  //       return await ctx.jsonapi.add(`/${ prop }${ path }`, _value)\r\n  //     }\r\n  //   }\r\n  //\r\n  //   return descriptor\r\n  // }, {}))\r\n\r\n  await next()\r\n\r\n  ctx.set('content-type', `${ mediaTypes[0] };charset=utf-8`)\r\n}\r\n","import JsonApi from '@alexeimyshkouski/json-api'\r\nimport defaults from 'lodash.defaultsdeep'\r\n\r\nexport default options => {\r\n  options = defaults({}, options, {\r\n    request: true,\r\n    response: false\r\n  })\r\n\r\n  return async (ctx, next) => {\r\n    if (options.request && ctx.state.hasBody) {\r\n      try {\r\n        await JsonApi.validate(ctx.request.body)\r\n      } catch (error) {\r\n        ctx.throw(422, {\r\n          detail: `ValidationError: request body is not valid`,\r\n          meta: error.reasons\r\n        })\r\n      }\r\n    }\r\n\r\n    await next()\r\n\r\n    if (options.response) {\r\n      try {\r\n        await JsonApi.validate(ctx.body)\r\n      } catch (error) {\r\n        Object.assign({\r\n          detail: `ValidationError: response body is not valid`,\r\n          meta: error.reasons\r\n        })\r\n\r\n        throw error\r\n      }\r\n    }\r\n  }\r\n}\r\n","module.exports = require(\"@alexeimyshkouski/json-api\");","module.exports = require(\"ajv\");","module.exports = require(\"ajv-errors\");","module.exports = require(\"babel-runtime/core-js/get-iterator\");","module.exports = require(\"babel-runtime/core-js/object/assign\");","module.exports = require(\"babel-runtime/core-js/object/define-properties\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");","module.exports = require(\"babel-runtime/helpers/typeof\");","module.exports = require(\"babel-runtime/regenerator\");","module.exports = require(\"http-errors\");","module.exports = require(\"json8-patch\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-router\");","module.exports = require(\"lodash.defaultsdeep\");","module.exports = require(\"lodash/defaultsDeep\");","module.exports = require(\"lodash/pick\");"],"sourceRoot":""}